# Android Machine Coding é¢è¯•å¤ä¹ å»ºè®®

## ğŸ“‹ é¢è¯•è¦æ±‚å›é¡¾

### è¯„ä¼°æ ‡å‡†
1. **Problem solvingï¼ˆé—®é¢˜è§£å†³èƒ½åŠ›ï¼‰**
   - å°†é—®é¢˜åˆ†è§£ä¸ºæ›´å°çš„éƒ¨åˆ†
   - éœ€æ±‚æ”¶é›†å’Œç†è§£

2. **Design patternsï¼ˆè®¾è®¡æ¨¡å¼ï¼‰**
   - æ¸…æ™°çš„å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰
   - è‰¯å¥½çš„æŠ½è±¡å±‚
   - æ”¯æŒåŠŸèƒ½æ‰©å±•çš„è®¾è®¡

3. **Framework fundamentalsï¼ˆæ¡†æ¶åŸºç¡€çŸ¥è¯†ï¼‰**
   - ä½œç”¨åŸŸå‡½æ•°ï¼ˆScoped functionsï¼‰
   - å¼‚æ­¥ä»£ç å¤„ç†
   - è§†å›¾ç”Ÿå‘½å‘¨æœŸï¼ˆView lifecycleï¼‰

---

## ğŸ¯ ä¸€ã€é—®é¢˜è§£å†³èƒ½åŠ›ï¼ˆProblem Solvingï¼‰

### 1.1 éœ€æ±‚åˆ†ææŠ€å·§

#### å…³é”®æ­¥éª¤
1. **ä»”ç»†é˜…è¯»é—®é¢˜æè¿°**
   - è¯†åˆ«æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚
   - è¯†åˆ«è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
   - è¯†åˆ«æ€§èƒ½è¦æ±‚

2. **æé—®æ¾„æ¸…éœ€æ±‚**
   - æ•°æ®æ¥æºæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆAPIã€æœ¬åœ°æ•°æ®åº“ã€ç”¨æˆ·è¾“å…¥ï¼‰
   - æ˜¯å¦éœ€è¦ç¦»çº¿æ”¯æŒï¼Ÿ
   - é”™è¯¯å¤„ç†ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ
   - UIäº¤äº’ç»†èŠ‚ï¼ˆä¸‹æ‹‰åˆ·æ–°ã€ä¸Šæ‹‰åŠ è½½ç­‰ï¼‰

3. **åŠŸèƒ½ä¼˜å…ˆçº§æ’åº**
   - Must haveï¼ˆå¿…é¡»å®ç°ï¼‰
   - Should haveï¼ˆåº”è¯¥å®ç°ï¼‰
   - Nice to haveï¼ˆå¯é€‰å®ç°ï¼‰

#### å®æˆ˜ç»ƒä¹ 
```
ç»ƒä¹ åœºæ™¯ï¼š
- å®ç°ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨é¡µé¢
- å®ç°ä¸€ä¸ªæœç´¢åŠŸèƒ½
- å®ç°ä¸€ä¸ªè¯¦æƒ…é¡µé¢

ç»ƒä¹ æ–¹æ³•ï¼š
1. å…ˆåˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„éœ€æ±‚ç‚¹
2. ä¸é¢è¯•å®˜ç¡®è®¤ä¼˜å…ˆçº§
3. åˆ¶å®šå®ç°è®¡åˆ’
```

### 1.2 é—®é¢˜åˆ†è§£æ–¹æ³•

#### åˆ†è§£ç­–ç•¥
1. **æŒ‰åŠŸèƒ½æ¨¡å—åˆ†è§£**
   ```
   ç”¨æˆ·åˆ—è¡¨åŠŸèƒ½
   â”œâ”€â”€ æ•°æ®è·å–ï¼ˆç½‘ç»œè¯·æ±‚ï¼‰
   â”œâ”€â”€ æ•°æ®å±•ç¤ºï¼ˆRecyclerViewï¼‰
   â”œâ”€â”€ åŠ è½½çŠ¶æ€ï¼ˆLoading/Errorï¼‰
   â”œâ”€â”€ ä¸‹æ‹‰åˆ·æ–°
   â””â”€â”€ ç‚¹å‡»è·³è½¬è¯¦æƒ…
   ```

2. **æŒ‰æŠ€æœ¯å±‚æ¬¡åˆ†è§£**
   ```
   æ•°æ®å±‚ï¼šRepository â†’ DataSource â†’ API/Database
   ä¸šåŠ¡å±‚ï¼šUseCase/ViewModel
   å±•ç¤ºå±‚ï¼šActivity/Fragment â†’ Adapter
   ```

3. **æŒ‰æ—¶é—´é¡ºåºåˆ†è§£**
   - ç¬¬ä¸€æ­¥ï¼šæ­å»ºåŸºç¡€æ¶æ„
   - ç¬¬äºŒæ­¥ï¼šå®ç°æ ¸å¿ƒåŠŸèƒ½
   - ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ å¢å¼ºåŠŸèƒ½
   - ç¬¬å››æ­¥ï¼šé”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ

#### å¤ä¹ é‡ç‚¹
- âœ… ç»ƒä¹ å°†å¤æ‚åŠŸèƒ½æ‹†åˆ†ä¸ºå°ä»»åŠ¡
- âœ… ç†è§£MVP/MVVM/MVIæ¶æ„çš„åˆ†å±‚æ€æƒ³
- âœ… æŒæ¡ä¾èµ–å…³ç³»åˆ†æï¼ˆå“ªäº›æ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—ï¼‰

---

## ğŸ—ï¸ äºŒã€è®¾è®¡æ¨¡å¼ï¼ˆDesign Patternsï¼‰

### 2.1 å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰

#### æ ¸å¿ƒåŸåˆ™
æ¯ä¸ªç±»/æ¨¡å—åªè´Ÿè´£ä¸€ä»¶äº‹ï¼ŒèŒè´£æ¸…æ™°ã€‚

#### é¡¹ç›®ä¸­çš„ä½“ç°

**å½“å‰é¡¹ç›®ç»“æ„ï¼š**
```
dependencies/     â†’ ä¾èµ–é…ç½®å±‚
dispatcher/       â†’ åç¨‹è°ƒåº¦æŠ½è±¡å±‚
persistance/      â†’ æ•°æ®æŒä¹…åŒ–å±‚
customviews/      â†’ UIç»„ä»¶å±‚
extensions/       â†’ å·¥å…·å‡½æ•°å±‚
```

#### éœ€è¦å®ç°çš„å±‚æ¬¡

**æ¨èæ¶æ„ï¼ˆMVVM + Repositoryï¼‰ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer          â”‚
â”‚  (Activity/Fragment + ViewModel)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Domain Layer                 â”‚
â”‚  (UseCase/Business Logic)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Data Layer                   â”‚
â”‚  (Repository â†’ DataSource)          â”‚
â”‚  â”œâ”€â”€ RemoteDataSource (Retrofit)    â”‚
â”‚  â””â”€â”€ LocalDataSource (Room/SP)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å¤ä¹ é‡ç‚¹

**1. Repositoryæ¨¡å¼**
```kotlin
// ç¤ºä¾‹ï¼šUserRepository
interface UserRepository {
    fun getUsers(): Flowable<List<User>>
    fun getUserById(id: String): Flowable<User>
}

class UserRepositoryImpl(
    private val remoteDataSource: UserRemoteDataSource,
    private val localDataSource: UserLocalDataSource
) : UserRepository {
    override fun getUsers(): Flowable<List<User>> {
        // 1. å…ˆè¿”å›æœ¬åœ°æ•°æ®ï¼ˆå¿«é€Ÿå“åº”ï¼‰
        // 2. åŒæ—¶è¯·æ±‚ç½‘ç»œæ•°æ®
        // 3. æ›´æ–°æœ¬åœ°ç¼“å­˜
        return localDataSource.getUsers()
            .mergeWith(remoteDataSource.getUsers().doOnNext { 
                localDataSource.saveUsers(it) 
            })
    }
}
```

**2. ViewModelæ¨¡å¼**
```kotlin
class UserViewModel(
    private val userRepository: UserRepository,
    private val dispatcherProvider: CoroutineDispatcherProvider
) : ViewModel() {
    
    private val _users = MutableLiveData<List<User>>()
    val users: LiveData<List<User>> = _users
    
    private val _loading = MutableLiveData<Boolean>()
    val loading: LiveData<Boolean> = _loading
    
    fun loadUsers() {
        viewModelScope.launch(dispatcherProvider.io) {
            _loading.postValue(true)
            try {
                val result = userRepository.getUsers().first()
                _users.postValue(result)
            } catch (e: Exception) {
                // é”™è¯¯å¤„ç†
            } finally {
                _loading.postValue(false)
            }
        }
    }
}
```

**3. UseCaseæ¨¡å¼ï¼ˆå¯é€‰ï¼Œç”¨äºå¤æ‚ä¸šåŠ¡é€»è¾‘ï¼‰**
```kotlin
class GetUsersUseCase(
    private val userRepository: UserRepository
) {
    suspend fun execute(): Result<List<User>> {
        return try {
            Result.Success(userRepository.getUsers().first())
        } catch (e: Exception) {
            Result.Error(e)
        }
    }
}
```

### 2.2 æŠ½è±¡å±‚è®¾è®¡

#### æ¥å£æŠ½è±¡çš„å¥½å¤„
1. **ä¾¿äºæµ‹è¯•**ï¼šå¯ä»¥æ³¨å…¥Mockå¯¹è±¡
2. **ä¾¿äºåˆ‡æ¢å®ç°**ï¼šå¦‚åˆ‡æ¢ç½‘ç»œåº“ã€æ•°æ®åº“
3. **è§£è€¦**ï¼šä¸Šå±‚ä¸ä¾èµ–å…·ä½“å®ç°

#### é¡¹ç›®ä¸­çš„ä¾‹å­

**CoroutineDispatcherProvideræ¥å£ï¼š**
```kotlin
// æ¥å£å®šä¹‰
interface CoroutineDispatcherProvider {
    val main: CoroutineDispatcher
    val io: CoroutineDispatcher
}

// çœŸå®å®ç°
class RealCoroutineDispatcherProvider : CoroutineDispatcherProvider {
    override val main = Dispatchers.Main
    override val io = Dispatchers.IO
}

// æµ‹è¯•å®ç°
class TestCoroutineDispatcherProvider : CoroutineDispatcherProvider {
    override val main = Dispatchers.Unconfined
    override val io = Dispatchers.Unconfined
}
```

#### éœ€è¦æŒæ¡çš„æŠ½è±¡

**1. Repositoryæ¥å£æŠ½è±¡**
```kotlin
interface UserRepository {
    suspend fun getUsers(): Result<List<User>>
}
```

**2. DataSourceæ¥å£æŠ½è±¡**
```kotlin
interface UserRemoteDataSource {
    suspend fun getUsers(): List<User>
}

interface UserLocalDataSource {
    suspend fun getUsers(): List<User>
    suspend fun saveUsers(users: List<User>)
}
```

**3. API Serviceæ¥å£ï¼ˆRetrofitï¼‰**
```kotlin
interface UserApiService {
    @GET("users")
    fun getUsers(): Observable<List<UserResponse>>
}
```

### 2.3 æ”¯æŒæ‰©å±•çš„è®¾è®¡

#### è®¾è®¡åŸåˆ™
1. **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
2. **ä¾èµ–å€’ç½®**ï¼šä¾èµ–æŠ½è±¡ï¼Œä¸ä¾èµ–å…·ä½“å®ç°
3. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç±»åªåšä¸€ä»¶äº‹

#### å®æˆ˜ç¤ºä¾‹

**åœºæ™¯ï¼šéœ€è¦æ”¯æŒå¤šç§æ•°æ®æº**
```kotlin
// æ¥å£å®šä¹‰
interface DataSource<T> {
    suspend fun getData(): Result<T>
}

// ä¸åŒå®ç°
class RemoteDataSource<T> : DataSource<T> { ... }
class LocalDataSource<T> : DataSource<T> { ... }
class CacheDataSource<T> : DataSource<T> { ... }

// Repositoryå¯ä»¥ç»„åˆå¤šä¸ªæ•°æ®æº
class Repository(
    private val remote: DataSource<User>,
    private val local: DataSource<User>
) {
    suspend fun getData(): Result<User> {
        // æ™ºèƒ½é€‰æ‹©æ•°æ®æº
    }
}
```

#### å¤ä¹ é‡ç‚¹
- âœ… ç†è§£æ¥å£å’Œå®ç°åˆ†ç¦»
- âœ… æŒæ¡ä¾èµ–æ³¨å…¥çš„ä½¿ç”¨
- âœ… ç†è§£ç»„åˆä¼˜äºç»§æ‰¿
- âœ… æŒæ¡ç­–ç•¥æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼åœ¨Androidä¸­çš„åº”ç”¨

---

## ğŸ”§ ä¸‰ã€æ¡†æ¶åŸºç¡€çŸ¥è¯†ï¼ˆFramework Fundamentalsï¼‰

### 3.1 Kotlinä½œç”¨åŸŸå‡½æ•°ï¼ˆScoped Functionsï¼‰

#### äº”ç§ä½œç”¨åŸŸå‡½æ•°å¯¹æ¯”

| å‡½æ•° | å¯¹è±¡å¼•ç”¨ | è¿”å›å€¼ | ä½¿ç”¨åœºæ™¯ |
|------|---------|--------|---------|
| `let` | `it` | Lambdaç»“æœ | ç©ºå€¼æ£€æŸ¥ã€é“¾å¼è°ƒç”¨ |
| `run` | `this` | Lambdaç»“æœ | å¯¹è±¡é…ç½®ã€è®¡ç®— |
| `with` | `this` | Lambdaç»“æœ | éæ‰©å±•å‡½æ•°ï¼Œé…ç½®å¯¹è±¡ |
| `apply` | `this` | å¯¹è±¡æœ¬èº« | å¯¹è±¡åˆå§‹åŒ– |
| `also` | `it` | å¯¹è±¡æœ¬èº« | é™„åŠ æ“ä½œã€æ—¥å¿—è®°å½• |

#### å®é™…åº”ç”¨ç¤ºä¾‹

**1. let - ç©ºå€¼æ£€æŸ¥å’Œè½¬æ¢**
```kotlin
// ç½‘ç»œè¯·æ±‚ç»“æœå¤„ç†
userResponse?.let { response ->
    val user = response.toUser()
    _user.value = user
}

// é“¾å¼è°ƒç”¨
user?.let { it.name }?.let { it.toUpperCase() }
```

**2. run - å¯¹è±¡é…ç½®å’Œè®¡ç®—**
```kotlin
// ViewModelä¸­
val result = run {
    val data = fetchData()
    processData(data)
}

// é…ç½®å¯¹è±¡
val client = OkHttpClient.Builder().run {
    connectTimeout(10, TimeUnit.SECONDS)
    readTimeout(10, TimeUnit.SECONDS)
    build()
}
```

**3. apply - å¯¹è±¡åˆå§‹åŒ–**
```kotlin
// åˆ›å»ºå¹¶é…ç½®å¯¹è±¡
val user = User().apply {
    name = "John"
    age = 30
    email = "john@example.com"
}

// Retrofité…ç½®
val retrofit = Retrofit.Builder().apply {
    baseUrl("https://api.example.com")
    addConverterFactory(GsonConverterFactory.create())
}.build()
```

**4. also - é™„åŠ æ“ä½œ**
```kotlin
// æ—¥å¿—è®°å½•
userRepository.getUsers()
    .also { Log.d("UserRepository", "Fetching users") }
    .subscribe { users -> ... }

// è°ƒè¯•
val result = calculate()
    .also { println("Result: $it") }
```

**5. with - éæ‰©å±•å‡½æ•°**
```kotlin
// é…ç½®å¤šä¸ªå±æ€§
with(user) {
    name = "John"
    age = 30
    email = "john@example.com"
}
```

#### å¤ä¹ é‡ç‚¹
- âœ… ç†è§£æ¯ç§ä½œç”¨åŸŸå‡½æ•°çš„åŒºåˆ«
- âœ… æŒæ¡ä½•æ—¶ä½¿ç”¨å“ªç§å‡½æ•°
- âœ… é¿å…è¿‡åº¦ä½¿ç”¨ï¼ˆä»£ç å¯è¯»æ€§ï¼‰
- âœ… ç»ƒä¹ åœ¨å®é™…åœºæ™¯ä¸­åº”ç”¨

### 3.2 å¼‚æ­¥ä»£ç å¤„ç†

#### é¡¹ç›®ä¸­çš„å¼‚æ­¥æ–¹æ¡ˆ

**1. RxJavaï¼ˆå½“å‰é¡¹ç›®å·²é…ç½®ï¼‰**
```kotlin
// ç½‘ç»œè¯·æ±‚
interface ApiService {
    @GET("users")
    fun getUsers(): Observable<List<User>>
}

// åœ¨Repositoryä¸­ä½¿ç”¨
class UserRepository(private val apiService: ApiService) {
    fun getUsers(): Observable<List<User>> {
        return apiService.getUsers()
            .subscribeOn(Schedulers.io())
            .observeOn(AndroidSchedulers.mainThread())
            .doOnError { Log.e("Error", it.message) }
    }
}

// åœ¨ViewModelä¸­ä½¿ç”¨
class UserViewModel(private val repository: UserRepository) {
    fun loadUsers() {
        repository.getUsers()
            .subscribe(
                { users -> _users.value = users },
                { error -> _error.value = error }
            )
    }
}
```

**2. Kotlinåç¨‹ï¼ˆæ¨èï¼Œæ›´ç°ä»£ï¼‰**
```kotlin
// ä½¿ç”¨åç¨‹
class UserViewModel(
    private val repository: UserRepository,
    private val dispatcherProvider: CoroutineDispatcherProvider
) : ViewModel() {
    
    fun loadUsers() {
        viewModelScope.launch(dispatcherProvider.io) {
            try {
                _loading.postValue(true)
                val users = repository.getUsers()
                _users.postValue(users)
            } catch (e: Exception) {
                _error.postValue(e)
            } finally {
                _loading.postValue(false)
            }
        }
    }
}

// Repositoryä½¿ç”¨suspendå‡½æ•°
interface UserRepository {
    suspend fun getUsers(): List<User>
}
```

**3. åç¨‹ä¸RxJavaç»“åˆ**
```kotlin
// å°†Observableè½¬æ¢ä¸ºFlow
fun Observable<T>.asFlow(): Flow<T> = flow {
    subscribe { emit(it) }
}

// å°†Flowè½¬æ¢ä¸ºObservable
fun <T> Flow<T>.asObservable(): Observable<T> = Observable.create { emitter ->
    launch {
        collect { emitter.onNext(it) }
    }
}
```

#### çº¿ç¨‹åˆ‡æ¢

**ä½¿ç”¨DispatcherProviderï¼ˆé¡¹ç›®å·²å®ç°ï¼‰ï¼š**
```kotlin
// åœ¨IOçº¿ç¨‹æ‰§è¡Œç½‘ç»œè¯·æ±‚
viewModelScope.launch(dispatcherProvider.io) {
    val data = repository.fetchData()
    
    // åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ›´æ–°UI
    withContext(dispatcherProvider.main) {
        _data.value = data
    }
}
```

#### å¤ä¹ é‡ç‚¹
- âœ… ç†è§£RxJavaçš„Observableã€Flowableã€Singleç­‰
- âœ… æŒæ¡RxJavaæ“ä½œç¬¦ï¼ˆmapã€flatMapã€filterç­‰ï¼‰
- âœ… ç†è§£åç¨‹çš„suspendå‡½æ•°
- âœ… æŒæ¡åç¨‹çš„ä½œç”¨åŸŸï¼ˆviewModelScopeã€lifecycleScopeï¼‰
- âœ… ç†è§£çº¿ç¨‹åˆ‡æ¢ï¼ˆsubscribeOnã€observeOnã€withContextï¼‰
- âœ… æŒæ¡é”™è¯¯å¤„ç†ï¼ˆtry-catchã€onErrorReturnç­‰ï¼‰

### 3.3 è§†å›¾ç”Ÿå‘½å‘¨æœŸï¼ˆView Lifecycleï¼‰

#### Activityç”Ÿå‘½å‘¨æœŸ

```
onCreate() â†’ onStart() â†’ onResume() â†’ [è¿è¡Œä¸­] â†’ onPause() â†’ onStop() â†’ onDestroy()
```

**å…³é”®æ–¹æ³•ï¼š**
```kotlin
class MainActivity : AppCompatActivity() {
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        // åˆå§‹åŒ–è§†å›¾ã€ç»‘å®šæ•°æ®ã€æ³¨å†Œç›‘å¬å™¨
        setContentView(R.layout.activity_main)
        setupViews()
    }
    
    override fun onStart() {
        super.onStart()
        // Activityå¯è§ä½†ä¸å¯äº¤äº’
    }
    
    override fun onResume() {
        super.onResume()
        // Activityå¯è§ä¸”å¯äº¤äº’ï¼Œå¯ä»¥æ¢å¤åŠ¨ç”»ã€æ›´æ–°UI
    }
    
    override fun onPause() {
        super.onPause()
        // Activityå¤±å»ç„¦ç‚¹ï¼Œæš‚åœåŠ¨ç”»ã€ä¿å­˜æ•°æ®
    }
    
    override fun onStop() {
        super.onStop()
        // Activityä¸å¯è§ï¼Œé‡Šæ”¾èµ„æº
    }
    
    override fun onDestroy() {
        super.onDestroy()
        // æ¸…ç†èµ„æºã€å–æ¶ˆç½‘ç»œè¯·æ±‚ã€æ³¨é”€ç›‘å¬å™¨
    }
}
```

#### Fragmentç”Ÿå‘½å‘¨æœŸ

```
onAttach() â†’ onCreate() â†’ onCreateView() â†’ onViewCreated() â†’ onStart() â†’ onResume()
â†’ onPause() â†’ onStop() â†’ onDestroyView() â†’ onDestroy() â†’ onDetach()
```

#### ViewModelç”Ÿå‘½å‘¨æœŸ

```
ViewModelåˆ›å»º â†’ Activity/Fragmentç”Ÿå‘½å‘¨æœŸ â†’ onCleared()
```

**å…³é”®ç‚¹ï¼š**
- ViewModelåœ¨é…ç½®å˜æ›´ï¼ˆå¦‚å±å¹•æ—‹è½¬ï¼‰æ—¶ä¸ä¼šé”€æ¯
- åœ¨Activity/FragmentçœŸæ­£é”€æ¯æ—¶è°ƒç”¨`onCleared()`

```kotlin
class UserViewModel : ViewModel() {
    
    override fun onCleared() {
        super.onCleared()
        // æ¸…ç†èµ„æºã€å–æ¶ˆåç¨‹ã€å–æ¶ˆè®¢é˜…
    }
}
```

#### LiveDataè§‚å¯Ÿç”Ÿå‘½å‘¨æœŸ

```kotlin
// è‡ªåŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ
viewModel.users.observe(this) { users ->
    // åªåœ¨Activity/Fragmentå¤„äºæ´»è·ƒçŠ¶æ€æ—¶æ›´æ–°UI
    updateUI(users)
}

// ä½¿ç”¨lifecycleScope
lifecycleScope.launch {
    // è‡ªåŠ¨åœ¨onDestroyæ—¶å–æ¶ˆ
    repository.getUsers().collect { users ->
        updateUI(users)
    }
}
```

#### å†…å­˜æ³„æ¼é¢„é˜²

**å¸¸è§é—®é¢˜ï¼š**
1. **æœªå–æ¶ˆç½‘ç»œè¯·æ±‚**
```kotlin
// âŒ é”™è¯¯ï¼šå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼
class MainActivity : AppCompatActivity() {
    private var disposable: Disposable? = null
    
    override fun onCreate(savedInstanceState: Bundle?) {
        disposable = repository.getUsers().subscribe()
    }
    
    // éœ€è¦åœ¨onDestroyä¸­å–æ¶ˆ
    override fun onDestroy() {
        disposable?.dispose()
        super.onDestroy()
    }
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨lifecycleScope
class MainActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        lifecycleScope.launch {
            repository.getUsers().collect { users ->
                updateUI(users)
            }
        }
    }
}
```

2. **æŒæœ‰Contextå¼•ç”¨**
```kotlin
// âŒ é”™è¯¯ï¼šæŒæœ‰Activityå¼•ç”¨
class UserRepository(private val context: Context) // å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼

// âœ… æ­£ç¡®ï¼šä½¿ç”¨Application Context
class UserRepository(private val context: Application)
```

#### å¤ä¹ é‡ç‚¹
- âœ… ç†Ÿè®°Activity/Fragmentç”Ÿå‘½å‘¨æœŸæ–¹æ³•
- âœ… ç†è§£ViewModelçš„ç”Ÿå‘½å‘¨æœŸ
- âœ… æŒæ¡LiveDataçš„è§‚å¯Ÿæœºåˆ¶
- âœ… ç†è§£lifecycleScopeçš„ä½¿ç”¨
- âœ… æŒæ¡å†…å­˜æ³„æ¼çš„é¢„é˜²æ–¹æ³•
- âœ… ç†è§£é…ç½®å˜æ›´çš„å¤„ç†

---

## ğŸ“š å››ã€é¡¹ç›®ç‰¹å®šæŠ€æœ¯å¤ä¹ 

### 4.1 ä¾èµ–æ³¨å…¥ - Koin

#### åŸºæœ¬ç”¨æ³•

**1. å®šä¹‰æ¨¡å—**
```kotlin
val userModule = module {
    // å•ä¾‹
    single<UserRepository> { UserRepositoryImpl(get(), get()) }
    
    // æ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹
    factory<UserAdapter> { UserAdapter() }
    
    // å¸¦å‚æ•°çš„å·¥å‚
    factory { (context: Context) -> 
        UserService(context) 
    }
}
```

**2. æ³¨å…¥ä¾èµ–**
```kotlin
// åœ¨Activity/Fragmentä¸­
class MainActivity : AppCompatActivity() {
    // å»¶è¿Ÿæ³¨å…¥
    private val userRepository: UserRepository by inject()
    
    // æˆ–è€…ç›´æ¥æ³¨å…¥
    private val userRepository by inject<UserRepository>()
}

// åœ¨ViewModelä¸­
class UserViewModel(
    private val userRepository: UserRepository // æ„é€ å‡½æ•°æ³¨å…¥
) : ViewModel()
```

#### å¤ä¹ é‡ç‚¹
- âœ… ç†è§£single vs factoryçš„åŒºåˆ«
- âœ… æŒæ¡get()çš„ä½¿ç”¨ï¼ˆè‡ªåŠ¨è§£æä¾èµ–ï¼‰
- âœ… ç†è§£æ¨¡å—çš„ç»„ç»‡æ–¹å¼
- âœ… æŒæ¡å¦‚ä½•åœ¨æµ‹è¯•ä¸­æ›¿æ¢ä¾èµ–

### 4.2 ç½‘ç»œè¯·æ±‚ - Retrofit + RxJava

#### Retrofitæ¥å£å®šä¹‰
```kotlin
interface UserApiService {
    @GET("users")
    fun getUsers(): Observable<List<UserResponse>>
    
    @GET("users/{id}")
    fun getUserById(@Path("id") userId: String): Observable<UserResponse>
    
    @POST("users")
    fun createUser(@Body user: UserRequest): Observable<UserResponse>
    
    @Query("page") page: Int,
    @Query("limit") limit: Int
    fun getUsersPaginated(
        @Query("page") page: Int,
        @Query("limit") limit: Int
    ): Observable<UserResponse>
}
```

#### åœ¨Moduleä¸­æ³¨å†Œ
```kotlin
val networkModule = module {
    // ... å…¶ä»–é…ç½®
    
    factory<UserApiService> {
        get<Retrofit>().create(UserApiService::class.java)
    }
}
```

#### å¤ä¹ é‡ç‚¹
- âœ… æŒæ¡Retrofitæ³¨è§£ï¼ˆ@GETã€@POSTã€@Pathã€@Queryã€@Bodyç­‰ï¼‰
- âœ… ç†è§£Observableçš„ä½¿ç”¨
- âœ… æŒæ¡é”™è¯¯å¤„ç†
- âœ… ç†è§£RxJavaæ“ä½œç¬¦çš„ä½¿ç”¨

### 4.3 æ•°æ®åº“ - Room

#### å®ä½“å®šä¹‰
```kotlin
@Entity(tableName = "users")
data class User(
    @PrimaryKey val id: String,
    val name: String,
    val email: String,
    @ColumnInfo(name = "created_at") val createdAt: Long
)
```

#### DAOå®šä¹‰
```kotlin
@Dao
interface UserDao {
    @Query("SELECT * FROM users")
    fun getAllUsers(): Flowable<List<User>>
    
    @Query("SELECT * FROM users WHERE id = :id")
    fun getUserById(id: String): Flowable<User>
    
    @Insert(onConflict = OnConflictStrategy.REPLACE)
    fun insertUser(user: User)
    
    @Insert(onConflict = OnConflictStrategy.REPLACE)
    fun insertUsers(users: List<User>)
    
    @Update
    fun updateUser(user: User)
    
    @Delete
    fun deleteUser(user: User)
}
```

#### Databaseå®šä¹‰
```kotlin
@Database(entities = [User::class], version = 1)
abstract class AppDatabase : RoomDatabase() {
    abstract fun userDao(): UserDao
}
```

#### å¤ä¹ é‡ç‚¹
- âœ… æŒæ¡Roomæ³¨è§£çš„ä½¿ç”¨
- âœ… ç†è§£Flowableä¸LiveDataçš„åŒºåˆ«
- âœ… æŒæ¡æ•°æ®åº“è¿ç§»ï¼ˆMigrationï¼‰
- âœ… ç†è§£äº‹åŠ¡å¤„ç†

### 4.4 è‡ªå®šä¹‰View

#### é¡¹ç›®ä¸­çš„FullScreenViewç¤ºä¾‹
```kotlin
class FullScreenView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyleAttr: Int = 0
) : FrameLayout(context, attrs, defStyleAttr) {
    
    init {
        inflate(context, R.layout.full_screen_view, this)
    }
    
    fun show(type: FullScreenViewType) { ... }
    fun hide(type: FullScreenViewType) { ... }
}
```

#### å¤ä¹ é‡ç‚¹
- âœ… ç†è§£è‡ªå®šä¹‰Viewçš„ä¸‰ç§æ„é€ å‡½æ•°
- âœ… æŒæ¡@JvmOverloadsçš„ä½œç”¨
- âœ… ç†è§£Viewçš„æµ‹é‡å’Œå¸ƒå±€è¿‡ç¨‹
- âœ… æŒæ¡è‡ªå®šä¹‰å±æ€§çš„ä½¿ç”¨

---

## ğŸ¯ äº”ã€å®æˆ˜ç»ƒä¹ å»ºè®®

### 5.1 åŸºç¡€åŠŸèƒ½å®ç°ç»ƒä¹ 

#### ç»ƒä¹ 1ï¼šç”¨æˆ·åˆ—è¡¨é¡µé¢
**éœ€æ±‚ï¼š**
- æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ï¼ˆä½¿ç”¨RecyclerViewï¼‰
- ä¸‹æ‹‰åˆ·æ–°
- åŠ è½½çŠ¶æ€æ˜¾ç¤º
- é”™è¯¯å¤„ç†

**å®ç°æ­¥éª¤ï¼š**
1. åˆ›å»ºUserå®ä½“ç±»
2. åˆ›å»ºUserApiServiceæ¥å£
3. åˆ›å»ºUserRepository
4. åˆ›å»ºUserViewModel
5. åˆ›å»ºUserAdapter
6. åœ¨Activityä¸­ç»‘å®š

#### ç»ƒä¹ 2ï¼šæœç´¢åŠŸèƒ½
**éœ€æ±‚ï¼š**
- å®æ—¶æœç´¢
- é˜²æŠ–å¤„ç†ï¼ˆé¿å…é¢‘ç¹è¯·æ±‚ï¼‰
- æœç´¢ç»“æœé«˜äº®

**æŠ€æœ¯ç‚¹ï¼š**
- RxJavaçš„debounceæ“ä½œç¬¦
- EditTextçš„æ–‡æœ¬ç›‘å¬

#### ç»ƒä¹ 3ï¼šè¯¦æƒ…é¡µé¢
**éœ€æ±‚ï¼š**
- æ˜¾ç¤ºç”¨æˆ·è¯¦æƒ…
- æ”¯æŒç¼–è¾‘
- æ•°æ®æŒä¹…åŒ–

**æŠ€æœ¯ç‚¹ï¼š**
- Roomæ•°æ®åº“æ“ä½œ
- æ•°æ®åŒå‘ç»‘å®š

### 5.2 æ¶æ„è®¾è®¡ç»ƒä¹ 

#### ç»ƒä¹ ï¼šå®ç°å®Œæ•´çš„MVVMæ¶æ„
```
1. Data Layer
   - RemoteDataSource (Retrofit)
   - LocalDataSource (Room)
   - Repositoryå®ç°

2. Domain Layer (å¯é€‰)
   - UseCaseç±»

3. Presentation Layer
   - ViewModel
   - Activity/Fragment
   - Adapter
```

### 5.3 é”™è¯¯å¤„ç†ç»ƒä¹ 

#### åœºæ™¯ï¼šç½‘ç»œè¯·æ±‚å¤±è´¥
```kotlin
// å®ç°ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
sealed class Result<out T> {
    data class Success<T>(val data: T) : Result<T>()
    data class Error(val exception: Exception) : Result<Nothing>()
    object Loading : Result<Nothing>()
}

// åœ¨Repositoryä¸­ä½¿ç”¨
suspend fun getUsers(): Result<List<User>> {
    return try {
        Result.Success(apiService.getUsers().await())
    } catch (e: Exception) {
        Result.Error(e)
    }
}
```

---

## ğŸ“– å…­ã€é¢è¯•å‡†å¤‡æ¸…å•

### 6.1 æŠ€æœ¯çŸ¥è¯†æ£€æŸ¥

- [ ] **KotlinåŸºç¡€**
  - [ ] ä½œç”¨åŸŸå‡½æ•°ï¼ˆletã€runã€withã€applyã€alsoï¼‰
  - [ ] æ‰©å±•å‡½æ•°
  - [ ] å¯†å°ç±»ï¼ˆsealed classï¼‰
  - [ ] æ•°æ®ç±»ï¼ˆdata classï¼‰
  - [ ] åç¨‹åŸºç¡€

- [ ] **Androidæ¶æ„**
  - [ ] MVVMæ¨¡å¼
  - [ ] Repositoryæ¨¡å¼
  - [ ] LiveDataå’ŒViewModel
  - [ ] ç”Ÿå‘½å‘¨æœŸç®¡ç†

- [ ] **å¼‚æ­¥å¤„ç†**
  - [ ] RxJavaåŸºç¡€ï¼ˆObservableã€æ“ä½œç¬¦ï¼‰
  - [ ] Kotlinåç¨‹ï¼ˆsuspendã€CoroutineScopeï¼‰
  - [ ] çº¿ç¨‹åˆ‡æ¢

- [ ] **ç½‘ç»œè¯·æ±‚**
  - [ ] Retrofitä½¿ç”¨
  - [ ] OkHttpé…ç½®
  - [ ] é”™è¯¯å¤„ç†

- [ ] **æ•°æ®å­˜å‚¨**
  - [ ] Roomæ•°æ®åº“
  - [ ] SharedPreferences
  - [ ] æ•°æ®ç¼“å­˜ç­–ç•¥

- [ ] **UIç»„ä»¶**
  - [ ] RecyclerViewå’ŒAdapter
  - [ ] è‡ªå®šä¹‰View
  - [ ] å¸ƒå±€ä¼˜åŒ–

- [ ] **ä¾èµ–æ³¨å…¥**
  - [ ] Koinä½¿ç”¨
  - [ ] æ¨¡å—ç»„ç»‡
  - [ ] æµ‹è¯•ä¸­çš„ä¾èµ–æ›¿æ¢

### 6.2 é—®é¢˜è§£å†³èƒ½åŠ›æ£€æŸ¥

- [ ] èƒ½å¤Ÿå¿«é€Ÿç†è§£éœ€æ±‚
- [ ] èƒ½å¤Ÿæå‡ºæ¾„æ¸…é—®é¢˜
- [ ] èƒ½å¤Ÿå°†é—®é¢˜åˆ†è§£ä¸ºå°ä»»åŠ¡
- [ ] èƒ½å¤Ÿåˆ¶å®šå®ç°è®¡åˆ’
- [ ] èƒ½å¤Ÿè¯†åˆ«è¾¹ç•Œæƒ…å†µ

### 6.3 è®¾è®¡èƒ½åŠ›æ£€æŸ¥

- [ ] ç†è§£å…³æ³¨ç‚¹åˆ†ç¦»
- [ ] èƒ½å¤Ÿè®¾è®¡æ¸…æ™°çš„å±‚æ¬¡ç»“æ„
- [ ] èƒ½å¤Ÿä½¿ç”¨æ¥å£æŠ½è±¡
- [ ] èƒ½å¤Ÿè€ƒè™‘æ‰©å±•æ€§
- [ ] èƒ½å¤Ÿè€ƒè™‘æµ‹è¯•æ€§

### 6.4 æ²Ÿé€šèƒ½åŠ›æ£€æŸ¥

- [ ] èƒ½å¤Ÿè§£é‡Šè®¾è®¡å†³ç­–
- [ ] èƒ½å¤Ÿæ¥å—åé¦ˆ
- [ ] èƒ½å¤Ÿä¸»åŠ¨æ²Ÿé€šè¿›åº¦
- [ ] èƒ½å¤Ÿå¯»æ±‚å¸®åŠ©

---

## ğŸ’¡ ä¸ƒã€é¢è¯•æŠ€å·§

### 7.1 å¼€å§‹ç¼–ç å‰

1. **ä»”ç»†é˜…è¯»éœ€æ±‚**ï¼ˆ5åˆ†é’Ÿï¼‰
   - ç†è§£æ ¸å¿ƒåŠŸèƒ½
   - è¯†åˆ«è¾¹ç•Œæƒ…å†µ
   - åˆ—å‡ºé—®é¢˜

2. **ä¸é¢è¯•å®˜ç¡®è®¤**ï¼ˆ5åˆ†é’Ÿï¼‰
   - æ¾„æ¸…éœ€æ±‚ç»†èŠ‚
   - ç¡®è®¤æŠ€æœ¯é€‰å‹
   - è®¨è®ºå®ç°æ–¹æ¡ˆ

3. **åˆ¶å®šè®¡åˆ’**ï¼ˆ5åˆ†é’Ÿï¼‰
   - åˆ—å‡ºå®ç°æ­¥éª¤
   - ç¡®å®šä¼˜å…ˆçº§
   - é¢„ä¼°æ—¶é—´

### 7.2 ç¼–ç è¿‡ç¨‹ä¸­

1. **å…ˆæ­å»ºæ¶æ„**
   - åˆ›å»ºå¿…è¦çš„æ¥å£
   - æ­å»ºåŸºç¡€ç»“æ„
   - é…ç½®ä¾èµ–æ³¨å…¥

2. **å®ç°æ ¸å¿ƒåŠŸèƒ½**
   - å…ˆå®ç°åŸºæœ¬åŠŸèƒ½
   - å†æ·»åŠ å¢å¼ºåŠŸèƒ½
   - æœ€åå¤„ç†è¾¹ç•Œæƒ…å†µ

3. **æŒç»­æ²Ÿé€š**
   - è§£é‡Šä½ çš„æ€è·¯
   - é‡åˆ°é—®é¢˜åŠæ—¶æ²Ÿé€š
   - æ¥å—åé¦ˆå¹¶è°ƒæ•´

### 7.3 å¸¸è§é—®é¢˜åº”å¯¹

**Q: å¦‚æœæ—¶é—´ä¸å¤Ÿæ€ä¹ˆåŠï¼Ÿ**
A: ä¼˜å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå¯ä»¥è¯´æ˜å“ªäº›åŠŸèƒ½æ˜¯MVPï¼Œå“ªäº›æ˜¯å¢å¼ºåŠŸèƒ½ã€‚

**Q: é‡åˆ°ä¸ç†Ÿæ‚‰çš„æŠ€æœ¯æ€ä¹ˆåŠï¼Ÿ**
A: è¯šå®è¯´æ˜ï¼Œä½†å±•ç¤ºå­¦ä¹ èƒ½åŠ›å’Œè§£å†³é—®é¢˜çš„æ€è·¯ã€‚

**Q: ä»£ç æœ‰bugæ€ä¹ˆåŠï¼Ÿ**
A: ä¸è¦æ…Œå¼ ï¼Œç³»ç»Ÿæ€§åœ°è°ƒè¯•ï¼Œå¯ä»¥è¯·é¢è¯•å®˜å¸®åŠ©å®šä½é—®é¢˜ã€‚

---

## ğŸ“š å…«ã€æ¨èå­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Androidå¼€å‘è€…æŒ‡å—](https://developer.android.com/guide)
- [Kotlinå®˜æ–¹æ–‡æ¡£](https://kotlinlang.org/docs/home.html)
- [Koinæ–‡æ¡£](https://insert-koin.io/)
- [Retrofitæ–‡æ¡£](https://square.github.io/retrofit/)
- [Roomæ–‡æ¡£](https://developer.android.com/training/data-storage/room)

### å®è·µé¡¹ç›®
- å®ç°ä¸€ä¸ªç®€å•çš„æ–°é—»App
- å®ç°ä¸€ä¸ªå¾…åŠäº‹é¡¹App
- å®ç°ä¸€ä¸ªå¤©æ°”App

### ä»£ç ç»ƒä¹ 
- æ¯å¤©å®ç°ä¸€ä¸ªå°åŠŸèƒ½
- é‡æ„ç°æœ‰ä»£ç 
- é˜…è¯»å¼€æºé¡¹ç›®ä»£ç 

---

## âœ… æœ€åæ£€æŸ¥

åœ¨é¢è¯•å‰ï¼Œç¡®ä¿ä½ èƒ½å¤Ÿï¼š

1. âœ… å¿«é€Ÿæ­å»ºMVVMæ¶æ„
2. âœ… å®ç°ç½‘ç»œè¯·æ±‚å’Œæ•°æ®å±•ç¤º
3. âœ… å¤„ç†åŠ è½½å’Œé”™è¯¯çŠ¶æ€
4. âœ… ä½¿ç”¨Roomè¿›è¡Œæ•°æ®æŒä¹…åŒ–
5. âœ… è§£é‡Šä½ çš„è®¾è®¡å†³ç­–
6. âœ… å¤„ç†é¢è¯•å®˜çš„åé¦ˆ

**è®°ä½ï¼šé¢è¯•ä¸ä»…æ˜¯æŠ€æœ¯æµ‹è¯•ï¼Œæ›´æ˜¯åä½œèƒ½åŠ›çš„å±•ç¤ºã€‚ä¿æŒæ²Ÿé€šï¼Œå±•ç¤ºä½ çš„æ€è€ƒè¿‡ç¨‹ï¼**

---

**ç¥ä½ é¢è¯•é¡ºåˆ©ï¼** ğŸš€

